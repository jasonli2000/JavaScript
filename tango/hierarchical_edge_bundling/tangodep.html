<!DOCTYPE html>
<meta charset="utf-8">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700|Roboto:400,700' rel='stylesheet' type='text/css'>
<!-- try to use google offline/local fonts
<link href='googlefonts.css' rel='stylesheet' type='text/css'>
-->
<link href='d3.dependencyedgebundling.css' rel='stylesheet' type='text/css'>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
<script src="d3.dependencyedgebundling.js"></script>
<script>
      $(function() {
        $( "button" ).button().click(function(event){
          event.preventDefault();
        });
      });
</script>
<body>
<div style="font-size:10px; position:absolute; right:100px; top:30px;">
  <button onclick="download_svg()">Download as svg file</button>
</div>
<div id="chart_placeholder"></div>
<script>
var chart = d3.chart.dependencyedgebundling();
var rooturl = location.host;
var ajaxpath = "http://" + rooturl + "/cdash/ajax/getsubprojectdependencies.php?project=test";
var localpath = "pkgdep.json";
d3.json(localpath, function(error, classes) {
  if (error){
    errormsg = "json error " + error + " data: " + classes;
    document.write(errormsg);
    return;
  }
  d3.select('#chart_placeholder')
    .datum(classes)
    .call(chart);
});

// function for download using svg-crowbar
function download_svg() {
  var e = document.createElement('script');

  if (window.location.protocol === 'https:') {
    e.setAttribute('src', 'https://raw.github.com/NYTimes/svg-crowbar/gh-pages/svg-crowbar.js');
  } 
  else { 
    e.setAttribute('src', 'http://nytimes.github.com/svg-crowbar/svg-crowbar.js'); 
  } 
  e.setAttribute('class', 'svg-crowbar');
  document.body.appendChild(e);
}
</script>

